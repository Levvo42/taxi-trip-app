<!DOCTYPE html>
<html>
<head>
    <title>Taxi Trip Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: auto;
            background-color: #fff;
            color: #000;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            background-color: #ffffff;
            color: #000000;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .result-box {
            margin-top: 20px;
            background: #f8f8f8;
            padding: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f0f0f0;
        }

        #map {
            height: 300px;
            width: 100%;
            margin-top: 20px;
            border: 1px solid #ccc;
        }

        .pac-container {
            z-index: 10000 !important;
        }
    </style>

    <!-- Google Maps with Places Autocomplete -->
    <script src="https://maps.googleapis.com/maps/api/js?key={{ map_data.api_key }}&libraries=places" defer></script>

    <script>
        function initMap() {
            const originInput = document.getElementById("origin");
            const destInput = document.getElementById("destination");

            new google.maps.places.Autocomplete(originInput);
            new google.maps.places.Autocomplete(destInput);

            {% if map_data %}
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 10,
                center: { lat: 63.4, lng: 13.1 }
            });

            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            directionsService.route(
                {
                    origin: "{{ map_data.origin }}",
                    destination: "{{ map_data.destination }}",
                    travelMode: google.maps.TravelMode.DRIVING
                },
                (response, status) => {
                    if (status === "OK") {
                        directionsRenderer.setDirections(response);
                    } else {
                        alert("Could not display route: " + status);
                    }
                }
            );
            {% endif %}
        }

        window.onload = function () {
            if (typeof google === 'object' && typeof google.maps === 'object') {
                initMap();
            }
        };
    </script>
</head>

<body>
    <h2>ðŸš– Taxi Trip Calculator</h2>

    <form method="POST">
        <input type="text" id="origin" name="origin" required placeholder="Start location" value="{{ origin }}">
        <input type="text" id="destination" name="destination" required placeholder="End location" value="{{ destination }}">
        <button type="submit">Calculate</button>
    </form>

    {% if map_data %}
    <div id="map"></div>
    {% endif %}

    {% if result %}
    <div class="result-box">
        <strong>From:</strong> {{ result.origin }}<br>
        <strong>To:</strong> {{ result.destination }}<br>
        <strong>Distance:</strong> {{ result.distance }} km<br>
        <strong>Duration:</strong> {{ result.duration }}
    </div>

    <h3>Estimated Cost per Tariff</h3>
    <table>
        <tr>
            <th>Tariff</th>
            <th>Total Cost (kr)</th>
        </tr>
        {% for item in result.calculations %}
        <tr>
            <td>{{ item.tariff }}</td>
            <td><strong>{{ item.total_cost }}</strong></td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
</body>
</html>
