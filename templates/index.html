<!DOCTYPE html>
<html lang="sv">
<head>
  <title>Taxi Trip Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
    }

    h2 {
      margin-bottom: 10px;
    }

    .shortcuts {
      margin: 20px 0;
    }

    .shortcut-btn {
      display: block;
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #28a745;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
      border-radius: 4px;
    }

    .shortcut-btn:hover {
      background-color: #218838;
    }

    .form-section {
      background: #f8f8f8;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    button[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #007BFF;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }

    button[type="submit"]:hover {
      background-color: #0056b3;
    }

    .result-box {
      margin-top: 20px;
      background: #f0f0f0;
      padding: 15px;
      border-radius: 8px;
    }

    img.map-preview {
      width: 100%;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #e0e0e0;
    }

    .settings-link {
      display: inline-block;
      margin-top: 10px;
      text-decoration: none;
      color: #007BFF;
      font-weight: bold;
    }
  </style>

  <!-- ‚úÖ Google Places API for autocomplete -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key={{ api_key }}&libraries=places"
    defer>
  </script>

  <script>
    function initAutocomplete() {
      const originInput = document.getElementById("origin");
      const destInput = document.getElementById("destination");

      if (originInput) {
        new google.maps.places.Autocomplete(originInput);
      }
      if (destInput) {
        new google.maps.places.Autocomplete(destInput);
      }
    }

    window.onload = function () {
      if (typeof google === 'object' && typeof google.maps === 'object') {
        initAutocomplete();
      }
    };
  </script>
</head>

<body>
  <h2>üöñ Taxi Trip Calculator</h2>

  <a class="settings-link" href="{{ url_for('settings') }}">‚öôÔ∏è Inst√§llningar</a>

  {% if predefined %}
  <div class="shortcuts">
    <h3>Snabbval ‚Äì fasta priser</h3>
    {% for name, price in predefined.items() %}
      <form method="POST">
        <input type="hidden" name="origin" value="Valfri plats">
        <input type="hidden" name="destination" value="{{ name }}">
        <button class="shortcut-btn" type="submit">{{ name }} ‚Äì {{ price }} kr</button>
      </form>
    {% endfor %}
  </div>
  {% endif %}

  <div class="form-section">
    <form method="POST">
      <label for="origin">Fr√•n:</label>
      <input type="text" id="origin" name="origin" placeholder="Startplats" value="{{ origin }}" required>

      <label for="destination">Till:</label>
      <input type="text" id="destination" name="destination" placeholder="Destination" value="{{ destination }}" required>

      <button type="submit">Ber√§kna pris</button>
    </form>
  </div>

  {% if result %}
    {% if result.map_url %}
    <img src="{{ result.map_url }}" alt="Karta" class="map-preview">
    {% endif %}

    <div class="result-box">
      <strong>Fr√•n:</strong> {{ result.origin }}<br>
      <strong>Till:</strong> {{ result.destination }}<br>
      <strong>Avst√•nd:</strong> {{ result.distance }} km<br>
      <strong>Restid:</strong> {{ result.duration }}
    </div>

    <h3>Pris per taxa</h3>
    <table>
      <tr>
        <th>Taxa</th>
        <th>Totalpris (kr)</th>
      </tr>
      {% for item in result.calculations %}
      <tr>
        <td>{{ item.tariff }}</td>
        <td><strong>{{ item.total_cost }}</strong></td>
      </tr>
      {% endfor %}
    </table>
  {% endif %}
</body>
</html>
